<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Cabin&display=swap" rel="stylesheet"> 
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <title>Rapyd-Fyre Social Checkout Toolkit</title>
    <!-- <script src="https://checkouttoolkit.rapyd.net"></script> -->
    <script src="https://sandboxcheckouttoolkit.rapyd.net"></script>
    <script>
        const data = [];

        function addPayee(){
            const email = document.getElementById('email').value;
            if (email.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/) != null
                && !data.includes(email)){
                data.push(email);
                document.getElementById('email').value = "";
                initList();
            }
            else{
                alert("invalid or duplicate email");
            }
        }

        function removePayee(email){
            data.splice(data.indexOf(email), 1);
            initList();
        }

        function initList(){
            const list  = document.getElementById('list');
            list.innerHTML = data.map(i => 
                `<li>
                    ${i}
                    <span onclick="removePayee(this.id)" id="${i}" class="material-symbols-outlined">
                        close
                    </span>
                    <input type="text" class="split" placeholder="$ Amount">
                </li>`
            ).join('');
        }

        window.onload = function () {            
            initList();
            
            fetch("https://ipinfo.io/json")

            let checkout = new RapydCheckoutToolkit({
                pay_button_text: "Click to pay",
                pay_button_color: "red",
                id: "checkout_129b5af92658fd07e260aa90096a3f56",
            });
            checkout.displayCheckout();
        }

        window.addEventListener('onCheckoutPaymentSuccess', function (event) {
            console.log(event.detail)
        });

        window.addEventListener('onCheckoutFailure', function (event) {
            console.log(event.detail.error)
        });

    </script>
    <link rel="stylesheet" href="./style.css">
</head>

<body>
    <h1>Rapyd-Fyre Social Checkout Toolkit</h1>
    
    <div id="paypal-requests">
        <ul id="list"></ul>
        <input type="text" id="email">
        <button onclick="addPayee()" id="addbutton">Add Payee</button>
    </div>
    
    <div style="width: 500px" id="rapyd-checkout"></div>


</body>

</html>